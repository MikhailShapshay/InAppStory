<p align="center">
    <h1 align="center">Test for InAppStory</h1>
</p>

Задача
-------------------
<p>Написать простой сервис для выдачи промокодов с REST API</p>
<p>В БД должны храниться уникальные промокоды.</p>
<p>Система должна иметь как минимум один endpoint.</p>
<p>По этому endpoint можно получить промокод.</p>
<p>Каждому пользователю доступен только один уникальный промокод.</p>
<p>Предусмотреть конкурентный доступ и корректную обработку ошибок.</p>
<p>Идентификация пользователя должна происходить по api-key</p>
<p>Наличие скриптов для заполнения тестовыми данными - будет плюсом.</p>
<p>Docker - будет плюсом.</p>
<p>Unit-тесты - будут плюсом.</p>
<p>Наличие open-api/swagger документации - будет плюсом.</p>

Зависимости
------------

<ul>
  <li>Фреймворк: Yii2</li>
  <li>PHP: 8.2</li>
  <li>DВ: mysql</li>
  <li>Сторонние пакеты:
      <ul>
          <li>"zircote/swagger-php"</li>
          <li>"doctrine/annotations"</li>
          <li>"phpunit/phpunit"</li>
      </ul>
  </li>
</ul>


Установка
------------

### Docker

Осуществите сборку и запуск контейнеров
~~~
docker compose build
docker compose up -d
~~~

Войдите в контейнер приложения

~~~
docker exec -it app sh
~~~

### Установка зависимостей и миграции

Запустите установку зависимостей

~~~
composer install
~~~

Запустите миграции базы данных

~~~
php yii migrate
~~~

### Начало работы

Перейдите по адресу:

~~~
http://localhost:8282/
~~~
    
Логин и пароль для входа:
<ul>
<li>admin</li>
<li>admin123</li>
</ul>

### Генерация начальных данных

На вкладке "Пользователи" нажмите кнопку "Сгенерировать 50 пользователей".

Пользователи генерируются с паролем по умолчанию: <b>user123</b>.

~~~
http://localhost:8282/
~~~

На вкладке "Промокоды" нажмите кнопку "Сгенерировать 50 Промокодов".

~~~
http://localhost:8282/promo-code/index
~~~

### PromoCode API

Для доступа к Swagger перейдите по адресу:

~~~
http://localhost:8282/api-doc/
~~~

Для получения ключа доступа к API воспользуйтесь методом "Получить api_key" из раздела "API-KEY" в формате:

~~~
{
  "username": "логин",
  "password": "пароль"
}
~~~

Полученный ключ необходимо внести в форму авторизации по кнопке "Authorize".

Для получения промокода авторизированным пользователем воспользуйтесь методом "Получить промокод" из раздела "PromoCode".

### Тестирование

Тесты PHPUnit для REST API находятся в файле:

~~~
tests/unit/controllers/api/PromoCodeRestControllerTest.php
~~~